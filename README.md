# Open Problems - Multimodal Single-Cell Integration
Описание и код решения соревнования [Open Problems - Multimodal Single-Cell Integration](https://www.kaggle.com/competitions/open-problems-multimodal)

**Результат**: 81/1220 (7%)

## Описание задачи
Необходимо предсказать, как измерения ДНК, РНК и белка изменяются в отдельных клетках по мере того, как стволовые клетки костного мозга развиваются в более зрелые клетки крови.

## Метрика
Коэффициент корреляции Пирсона
## Данные
Фактически, в рамках соревнования предполагалось решить 2 задачи
*  Для образцов Multiome предсказать экспрессию генов, учитывая доступность хроматина
*  Для образцов CITEseq : предсказать уровни белка, учитывая экспрессию генов 

Обучающая выборка содержит данные за дни 2, 3, 4 для образцов CITEseq и за дни 2, 3, 4, 7 для образцов Multiome от 3 доноров. Приватный тестовый набор содержит данные за 7 день для образцов CITEseq 10 день для образцов Multiome от 4 доноров (3 донора из обучающей выборки и 1 новый донор)
![image](https://www.googleapis.com/download/storage/v1/b/kaggle-user-content/o/inbox%2F4308072%2F23e8c1f6faea1453998544cdc116a20e%2FNeurIPS%202022%20-%20Frame%204.jpg?generation=1660755395301873&alt=media)
## Схема кросс-валидации
GroupKFold: группировка по донорам
## Решение
* Было удалено 1194 гена, у которых был одинаковый уровень экспрессии для каждой клетки
* Признаки для обчающей выборки формировались следующим образом: был применен алгоритм понижения размерности TruncatedSVD (выбран, поскольку может эффективно работать с разреженными матрицами), а также добавлялось от 60 до 120 необработанных признаков, выбранных одним из следующих способов:

   1. Путем изучения биологических ресурсов отобраны гены, которые кодируют белки, чьи уровни необходимо предсказать, а также наиболее важные гены
   2. [Признаки](https://github.com/sfnga/Open-Problems-Multimodal-Single-Cell-Integration/blob/main/select-most-correlated.ipynb), с максимальным значением модуля коэффициента корреляции между ними и целевыми переменными
   3. Permutation importance (не хватило времени для реализации). На первом этапе было создано порядка 210 непересекающихся подмножеств признаков (в каждом ~100 признаков), для каждого признака была подсчитана важность на основе перестановки, и из каждого подмножества были отобраны лишь те признаки, у которых важность на основе перестановки была положительной для каждого фолда. Затем предполагалось также разбить отобранные признаки на подмножества и повторить процедуру отбора
* **Модели**: 5 нейронных сетей, обученных на разном подмножестве признаков, 1 Catboost, 1 TabNet.
Каждая модель обучалась на 5 наборах данных, полученных путем применения TruncatedSVD с различными значениями random_state к исходным данным. Это позволило увеличить метрику на 0.0009-0.0011 для каждой модели
*  Подбор весов для ансамбля осуществлялся методом Нелдера-Мида

## Не сработало
*  различные варианты преобразования исходных данных (логарифмирование, возведение в степень от 1/4 до 1)
*  использование статистик для каждой клетки (количество генов с ненулевой экспрессией для каждой клетки составляет 18-27%. Поэтому предполагалось использовать данную информацию для построения признаков: количество генов с ненулевой экспрессией, среднее значение экспрессии генов, медиана экспрессии генов...)
